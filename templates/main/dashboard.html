{% extends "base.html" %}
{% block title %}Dashboard{% endblock title %}
{% block content %}
<div class="dashboard-container">
    <h1>Dashboard</h1>
    <div class="balance-section">
        <p><strong>Balance (Cash):</strong> {{ balance_cash }}</p>
        <p><strong>Balance (Card):</strong> {{ balance_card }}</p>
        <p><strong>Overall Balance:</strong> {{ overall_balance }}</p>
    </div>

    <div class="expenses-section">
        <h2>Xarajatlar</h2>
        <p><strong>Haftalik xarajatlar:</strong> {{ weekly_expenses }}</p>
        <p><strong>Oylik xarajatlar:</strong> {{ monthly_expenses }}</p>
        <p><strong>Yillik xarajatlar:</strong> {{ yearly_expenses }}</p>
    </div>

    <div class="actions-section">
        <h2>Actions</h2>
        <a href="{% url 'add_income' %}" class="action-button">Daromad qo'shish</a>
        <a href="{% url 'add_expense' %}" class="action-button">Xarajat qo'shish</a>
    </div>

    <div class="charts-section">
        <h2>Grafiklar</h2>
        <div class="chart-container">
            <canvas id="incomeChart" width="400" height="400"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="expenseChart" width="400" height="400"></canvas>
        </div>
    </div>
</div>

<script>
    const incomesLast12Months = {{ incomes_last_12_months|safe }};
    const expensesLast12Months = {{ expenses_last_12_months|safe }};
    const today = new Date();
    const months = [];
    for (let i = 0; i < 12; i++) {
        months.push(new Date(today.getFullYear(), today.getMonth() - i, 1).toLocaleString('default', { month: 'short' }));
    }
    months.reverse();

    console.log("Incomes Last 12 Months: ", incomesLast12Months);
    console.log("Expenses Last 12 Months: ", expensesLast12Months);

    const incomeCtx = document.getElementById('incomeChart').getContext('2d');
    const incomeChart = new Chart(incomeCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Income in the Last 12 Months',
                data: incomesLast12Months,
                borderColor: '#36a2eb',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'category',
                    labels: months
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const expenseCtx = document.getElementById('expenseChart').getContext('2d');
    const expenseChart = new Chart(expenseCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Expenses in the Last 12 Months',
                data: expensesLast12Months,
                borderColor: '#ff6384',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'category',
                    labels: months
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<style>
    .dashboard-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .balance-section, .expenses-section, .actions-section, .charts-section {
        margin-bottom: 20px;
    }

    .balance-section p, .expenses-section p {
        font-size: 1.1em;
        margin: 10px 0;
    }

    .action-button {
        display: inline-block;
        margin: 10px 5px;
        padding: 10px 20px;
        background-color: #007BFF;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    .action-button:hover {
        background-color: #0056b3;
    }

    .chart-container {
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
    }
</style>
{% endblock content %}
