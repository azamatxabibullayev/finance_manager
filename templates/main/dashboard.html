{% extends "base.html" %}
{% block title %}Dashboard{% endblock title %}
{% block content %}
<div class="content">
    <h1>Dashboard</h1>
    <p>Balance (Cash): {{ balance_cash }}</p>
    <p>Balance (Card): {{ balance_card }}</p>
    <p>Overall Balance: {{ overall_balance }}</p>

    <h2>Xarajatlar</h2>
    <p>Haftalik xarajatlar: {{ weekly_expenses }}</p>
    <p>Oylik xarajatlar: {{ monthly_expenses }}</p>
    <p>Yillik xarajatlar: {{ yearly_expenses }}</p>

    <h2>Actions</h2>
    <a href="{% url 'add_income' %}">Daromad qo'shish</a>
    <a href="{% url 'add_expense' %}">Xarajat qo'shish</a>

    <h2>Grafiklar</h2>
    <div class="chart-container">
        <canvas id="incomeChart" width="400" height="400"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="expenseChart" width="400" height="400"></canvas>
    </div>
</div>

<script>
    const incomesLast12Months = {{ incomes_last_12_months|safe }};
    const expensesLast12Months = {{ expenses_last_12_months|safe }};
    const today = new Date();
    const months = [];
    for (let i = 0; i < 12; i++) {
        months.push(new Date(today.getFullYear(), today.getMonth() - i, 1).toLocaleString('default', { month: 'short' }));
    }
    months.reverse();

    console.log("Incomes Last 12 Months: ", incomesLast12Months);
    console.log("Expenses Last 12 Months: ", expensesLast12Months);

    const incomeCtx = document.getElementById('incomeChart').getContext('2d');
    const incomeChart = new Chart(incomeCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Income in the Last 12 Months',
                data: incomesLast12Months,
                borderColor: '#36a2eb',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'category',
                    labels: months
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    const expenseCtx = document.getElementById('expenseChart').getContext('2d');
    const expenseChart = new Chart(expenseCtx, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label: 'Expenses in the Last 12 Months',
                data: expensesLast12Months,
                borderColor: '#ff6384',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'category',
                    labels: months
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<style>
    .chart-container {
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
    }
</style>
{% endblock content %}