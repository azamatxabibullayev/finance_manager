{% extends "base.html" %}
{% block title %}{{ period|capfirst }} Income Stats{% endblock title %}
{% block content %}
<div class="content">
    <h1>{{ period|capfirst }} Income Stats</h1>
    <p>Total Income: {{ total_income }}</p>

    <!-- Display income data in a table -->
    <h2>Income Data</h2>
    <table>
        <thead>
        <tr>
            <th>Date</th>
            <th>Amount</th>
        </tr>
        </thead>
        <tbody>
        {% for income in incomes %}
        <tr>
            <td>{{ income.date }}</td>
            <td>{{ income.amount }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Doughnut Chart for Income Distribution -->
    <h2>Income Distribution</h2>
    <div class="chart-container">
        <canvas id="incomeDistributionChart" width="400" height="400"></canvas>
    </div>

    <!-- Line Chart for Income Over Time -->
    <h2>Income Over Time</h2>
    <div class="chart-container">
        <canvas id="incomeLineChart" width="400" height="400"></canvas>
    </div>

    <a href="{% url 'dashboard' %}">Back to Dashboard</a>
</div>

<script>
    // Get income data from Django context
    const incomeData = {{ incomes_json|safe }};
    const dates = incomeData.map(income => income.date);
    const amounts = incomeData.map(income => income.amount);

    // Prepare data for Doughnut Chart
    const distributionData = amounts.reduce((acc, amount) => {
        acc.total += amount;
        acc.distribution.push(amount);
        return acc;
    }, { total: 0, distribution: [] });

    // Doughnut Chart
    const incomeDistributionCtx = document.getElementById('incomeDistributionChart').getContext('2d');
    const incomeDistributionChart = new Chart(incomeDistributionCtx, {
        type: 'doughnut',
        data: {
            labels: dates,
            datasets: [{
                label: 'Income Distribution',
                data: distributionData.distribution,
                backgroundColor: ['#ff6384', '#36a2eb', '#cc65fe', '#ffce56'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            width: 400,
            height: 400
        }
    });

    // Line Chart
    const incomeLineCtx = document.getElementById('incomeLineChart').getContext('2d');
    const incomeLineChart = new Chart(incomeLineCtx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [{
                label: 'Income Over Time',
                data: amounts,
                borderColor: '#36a2eb',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            width: 400,
            height: 400
        }
    });
</script>
<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    table, th, td {
        border: 1px solid #ddd;
    }
    th, td {
        padding: 10px;
        text-align: left;
    }
    th {
        background-color: #f4f4f4;
    }
    .chart-container {
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
    }
</style>
{% endblock content %}
